# JavaScript Bridge 인터페이스 명세 (v2)

## 개요

본 인터페이스는 이벤트 웹 페이지(WebView 내)와 네이티브 애플리케이션(Android/iOS) 간의 양방향 통신을 정의합니다. 모든 데이터는 JSON 형식으로 직렬화되어 전달됩니다.

*   **네이티브 -> 웹:** 웹의 전역(window) 스코프에 정의된 JavaScript 함수를 호출합니다.
*   **웹 -> 네이티브:** 웹의 `window.nativeApp` 객체에 정의된 함수를 호출합니다. (`nativeApp`은 네이티브에서 주입해주는 브릿지 객체 이름의 예시입니다.)

**v2 변경사항:**
*   **초기화 흐름 변경:** 웹 페이지가 URL 파라미터에서 `eventId`를 읽어 네이티브 앱에 전달하는 `onPageReady` 함수가 추가되었습니다. 네이티브 앱은 이 `eventId`를 받아 백엔드에 데이터를 요청합니다.

---

## 1. 네이티브 (App) → 웹 (WebView) 호출

네이티브 앱이 웹뷰의 콘텐츠를 제어하기 위해 호출하는 함수들입니다.

### 1.1. `initializeEvent(data)`

*   **설명:**
    네이티브 앱이 **백엔드로부터 이벤트 데이터를 성공적으로 가져온 후**, 웹뷰에 정보를 전달하여 페이지 UI를 최종적으로 렌더링하기 위해 호출합니다.
*   **호출 시점:**
    웹뷰가 `onPageReady(eventId)`를 호출한 후, 네이티브 앱이 해당 `eventId`로 백엔드 API 통신을 완료했을 때.
*   **데이터 (JSON 구조):**
    `data` 파라미터는 이벤트 표시에 필요한 모든 정보를 담고 있는 JSON 객체입니다.

    ```json
    {
      "eventId": "evt_12345abc", 
      "title": "식권을 긁어보세요", 
      "subtitle": "식권대장 이벤트", 
      "scratchArea": {
        "coverColor": "#A7B9C6", 
        "guideText": "여기를 긁어보세요"
      },
      "rules": [ 
        {
          "type": "normal", 
          "text": "이벤트 등록 시 작성한 유의사항 문구가 보여지는 곳"
        },
        {
          "type": "normal",
          "text": "줄바꿈이나"
        },
        {
          "type": "bold",
          "text": "볼드처리도 가능하구요"
        }
      ],
      "prizes": [ 
        { "grade": "1등", "name": "xx 프리미엄 세트 (1명)" },
        { "grade": "2등", "name": "xx 1박스 (3명)" },
        { "grade": "3등", "name": "1,000 포인트 (5명)" }
      ]
    }
    ```

### 1.2. `showResult(result)`

*   **설명:**
    사용자가 이벤트 참여 후, 네이티브 앱이 백엔드로부터 받아온 당첨/낙첨 결과를 웹뷰에 전달하여 결과를 표시하기 위해 호출합니다.
*   **호출 시점:**
    웹뷰가 `participateEvent()`를 호출한 후, 네이티브 앱이 백엔드 API로부터 응답을 받았을 때.
*   **데이터 (JSON 구조):**
    `result` 파라미터는 이벤트 참여 결과를 담고 있는 JSON 객체입니다.

    ```json
    {
      "status": "WIN", 
      "message": "1,000 포인트 당첨!", 
      "prize": { 
        "grade": "3등", 
        "name": "1,000 포인트"
      }
    }
    ```

---

## 2. 웹 (WebView) → 네이티브 (App) 호출

웹뷰에서 사용자 액션이 발생했을 때, 네이티브 앱의 기능을 요청하기 위해 호출하는 함수들입니다.

### 2.1. `window.nativeApp.onPageReady(eventId)`

*   **설명:**
    웹 페이지의 모든 리소스(JS, CSS) 로드가 완료된 직후 호출됩니다. 이 함수는 URL 쿼리 스트링에서 `eventId`를 추출하여 네이티브 앱에 전달합니다. 이 호출은 "웹 페이지가 준비되었으니, 이 이벤트 ID에 대한 데이터를 가져와서 `initializeEvent`로 돌려주세요" 라는 신호 역할을 합니다.
*   **호출 시점:**
    웹 페이지의 JavaScript가 실행되는 가장 첫 시점.
*   **전달 데이터:**
    *   `eventId` (String): URL의 `?eventId=` 파라미터에서 추출한 이벤트의 고유 ID.
    *   예시: `window.nativeApp.onPageReady("evt_12345abc");`

### 2.2. `window.nativeApp.participateEvent()`

*   **설명:**
    사용자가 복권을 충분히 긁어 결과를 확인할 준비가 되었을 때, 웹뷰가 네이티브 앱에게 이벤트 참여(결과 확인)를 요청하기 위해 호출합니다.
*   **호출 시점:**
    스크래치 영역이 60% 이상 지워졌을 때 등, 결과 표시 조건이 충족되었을 때.
*   **전달 데이터:**
    없음 (`void`). 네이티브 앱은 현재 컨텍스트(이벤트 ID, 사용자 정보)를 이미 알고 있으므로 별도 파라미터가 필요 없습니다.


